
<!DOCTYPE html>
<html lang="en" class="bg-background-primary">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>haxiom.io | pages - Java outruns C++ while std::filesystem stops for syscall snacks  Budi Syahiddin</title>
    <meta name="description" content="Exploring why Java outperformed C++ in a filesystem tree-walking benchmark and how the std::filesystem library was causing performance bottlenecks....">

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="Java outruns C++ while std::filesystem stops for syscall snacks" />
    <meta property="og:description" content="Exploring why Java outperformed C++ in a filesystem tree-walking benchmark and how the std::filesystem library was causing performance bottlenecks." />
    <meta property="og:image" content="/static/og-image.png" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:title" content="Java outruns C++ while std::filesystem stops for syscall snacks" />
    <meta property="twitter:description" content="Exploring why Java outperformed C++ in a filesystem tree-walking benchmark and how the std::filesystem library was causing performance bottlenecks." />
    <meta property="twitter:image" content="/static/og-image.png" />

    <script>
    // Reads theme from cookie to prevent FOUC (Flash of Unstyled Content)
    (() => {
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        const theme = getCookie('theme');
        // Prioritize cookie, otherwise check system preference
        if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    })();
</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="/static/main.css">
<link rel="icon" type="image/x-icon" href="/static/favicon.png">
<script type="module" defer src="/static/main.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Iosevka/6.0.0/iosevka/iosevka.min.css" integrity="sha512-3hU20586NsplKRzjf2jQN5vTRTI2EsXObrHDOBLGdkiRkneg699BlmBXWGHHFHADCF3TOk2BREsVy7qTkmvQqQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body class="flex flex-col min-h-screen" x-data="{}" x-init="
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
    
    document.querySelectorAll('.scroll-animate').forEach(el => observer.observe(el));
">

    <!-- Navigation -->
    <nav class="fixed w-full z-50 top-0 border-b border-border-color bg-background-primary/80 backdrop-blur-md">
    <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
        <a href="/" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
            <!-- Logo SVG -->
            <svg width="28" height="28" viewBox="0 0 150 150" fill="none" xmlns="http://www.w3.org/2000/svg"
                class="text-text-primary">
                <path fill="currentColor"
                    d="M 0 56.25 L 0 116.25 L 20.832031 116.25 C 23.023438 116.25 25.1875 116.636719 27.210938 117.390625 C 29.234375 118.144531 31.070312 119.25 32.617188 120.644531 C 34.164062 122.035156 35.394531 123.691406 36.230469 125.511719 C 37.070312 127.328125 37.5 129.28125 37.5 131.25 L 37.5 150 L 87.5 150 L 150 93.75 L 150 33.75 L 129.167969 33.75 C 126.976562 33.75 124.8125 33.363281 122.789062 32.609375 C 120.765625 31.855469 118.929688 30.75 117.382812 29.355469 C 115.835938 27.964844 114.605469 26.308594 113.769531 24.492188 C 112.929688 22.671875 112.5 20.71875 112.5 18.75 L 112.5 0 L 62.5 0 Z M 70.832031 112.5 L 41.667969 112.5 L 41.667969 71.25 L 79.167969 37.5 L 108.332031 37.5 L 108.332031 78.75 Z" />
            </svg>
            <span class="text-lg font-medium tracking-tight text-text-primary">Haxiom</span>
            <span class="text-text-secondary">/</span>
            <span class="text-sm text-text-secondary">pages</span>
        </a>

        <div class="flex items-center gap-4">
            <a href="https://ab.haxiom.io/track?variant=A&event=join_beta_click_pages&redirect=https://app.haxiom.io/auth/login"
                class="text-sm text-text-secondary hover:text-text-primary transition-colors hidden sm:block">Log In</a>
            <div class="inline-block">
                <button class="shiny-cta">
                    <a href="https://ab.haxiom.io/track?variant=A&event=join_beta_click_pages&redirect=https://app.haxiom.io">Sign Up</a>
                </button>
            </div>
        </div>
    </div>
</nav>

    <!-- Main Content -->
    <main class="flex-1 w-full pt-24 pb-16 px-4 md:px-6 lg:px-8 bg-background-primary">
        <div class="max-w-4xl mx-auto">

            <!-- Article Header -->
            <div class="mb-12">
                <h1
                    class="text-4xl md:text-5xl lg:text-6xl font-medium text-text-primary tracking-tight leading-tight mb-6">
                    Java outruns C++ while std::filesystem stops for syscall snacks
                </h1>

                <!-- Article Meta Information -->
                <div
                    class="flex flex-wrap items-center justify-between gap-4 text-text-secondary border-t border-b border-border-color py-4">
                    <div class="flex items-center gap-3">
                            
    <img src="/2807b47c-a289-4e15-bcd2-a3d266a7d221/avatar"
        alt="Budi Syahiddin"
        class="w-10 h-10 rounded-full object-cover">

                        <div>
                            
                            <a href="/@budi-syahiddin-3425" class="text-sm text-text-secondary">@budi-syahiddin-3425</a>
                            
                        </div>
                    </div>
                    <div class="hidden md:block w-px h-8 bg-border-color"></div>
                    <span class="text-sm">21 November 2025</span>
                    <div class="flex-grow"></div>

                    <!-- Action buttons -->
                    <div class="flex items-center gap-2">
                        <a id="share-twitter" target="_blank" rel="noopener noreferrer"
                            class="p-2 border border-border-color bg-background-secondary text-text-secondary hover:text-text-primary hover:border-accent-primary transition-all"
                            title="Share on X">
                            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4">
                                <path fill="currentColor"
                                    d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z" />
                            </svg>
                        </a>
                        <a id="share-hackernews" target="_blank" rel="noopener noreferrer"
                            class="p-2 border border-border-color bg-background-secondary text-text-secondary hover:text-text-primary hover:border-accent-primary transition-all"
                            title="Share on Hacker News">
                            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4">
                                <path fill="currentColor"
                                    d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z" />
                            </svg>
                        </a>
                        <button id="share-link"
                            class="p-2 border border-border-color bg-background-secondary text-text-secondary hover:text-text-primary hover:border-accent-primary transition-all cursor-pointer"
                            title="Copy link">
                            <i data-lucide="link" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>

                <!-- Tags below meta info -->
                
                <div class="flex flex-wrap gap-2 mt-4">
                    
                    <span
                        class="bg-background-secondary text-text-secondary text-sm font-medium px-3 py-1.5 border border-border-color">c++</span>
                    
                    <span
                        class="bg-background-secondary text-text-secondary text-sm font-medium px-3 py-1.5 border border-border-color">io</span>
                    
                    <span
                        class="bg-background-secondary text-text-secondary text-sm font-medium px-3 py-1.5 border border-border-color">java</span>
                    
                    <span
                        class="bg-background-secondary text-text-secondary text-sm font-medium px-3 py-1.5 border border-border-color">syscalls</span>
                    
                </div>
                
            </div>

            <!-- Article Content -->
            <div id="article-content-container">
                <!-- Skeleton loader for article -->
                <div class="skeleton-paragraph">
                    <div class="skeleton-loader skeleton-line" style="width: 95%;"></div>
                    <div class="skeleton-loader skeleton-line" style="width: 100%;"></div>
                    <div class="skeleton-loader skeleton-line" style="width: 92%;"></div>
                    <div class="skeleton-loader skeleton-line" style="width: 98%;"></div>
                </div>
                <div class="skeleton-paragraph">
                    <div class="skeleton-loader skeleton-line" style="width: 97%;"></div>
                    <div class="skeleton-loader skeleton-line" style="width: 100%;"></div>
                    <div class="skeleton-loader skeleton-line" style="width: 90%;"></div>
                </div>
                <div class="skeleton-paragraph">
                    <div class="skeleton-loader skeleton-line" style="width: 94%;"></div>
                    <div class="skeleton-loader skeleton-line" style="width: 100%;"></div>
                    <div class="skeleton-loader skeleton-line" style="width: 96%;"></div>
                    <div class="skeleton-loader skeleton-line" style="width: 88%;"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
    // HTML Streaming Observer - handles progressive content loading
    (() => {
        const processStreamElement = (node) => {
            // Look for hidden divs with data-target attribute
            if (node instanceof HTMLElement &&
                node.hasAttribute('data-target') &&
                node.style.display === 'none') {

                const targetId = node.getAttribute('data-target');
                const target = document.getElementById(targetId);

                if (target) {
                    // Clear the skeleton loader first
                    target.innerHTML = '';

                    // Move all children from the hidden div to the target
                    while (node.firstChild) {
                        target.appendChild(node.firstChild);
                    }

                    // Remove the now-empty hidden div
                    node.remove();
                }
            }
        };

        const observerCallback = (mutationsList) => {
            for (const mutation of mutationsList) {
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach(node => {
                        processStreamElement(node);

                        // Also check children in case element is nested
                        if (node instanceof Element) {
                            const streamElements = node.querySelectorAll('[data-target][style*="display: none"]');
                            streamElements.forEach(processStreamElement);
                        }
                    });
                }
            }
        };

        const observer = new MutationObserver(observerCallback);

        // Start observing as soon as possible
        const startObserving = () => {
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
            console.log('Streaming observer started');
        };

        if (document.body) {
            startObserving();
            // Process any elements that might already be in the DOM
            document.querySelectorAll('[data-target][style*="display: none"]').forEach(processStreamElement);
        } else {
            document.addEventListener('DOMContentLoaded', () => {
                startObserving();
                document.querySelectorAll('[data-target][style*="display: none"]').forEach(processStreamElement);
            });
        }
    })();
</script><div id="stream-article" style="display: none;" data-target="article-content-container">
    <article class="markdown-body max-w-none prose prose-lg md:prose-xl mx-auto"><h1>Overview</h1>
<p>Recently, I began exploring the performance of concurrent filesystem tree walkers across various programming languages. I assumed that my C++ implementation would match or even exceed the speed of my Rust version. To my surprise, C++ lagged behind all my other implementations, including a single-threaded JavaScript version. Even with page caching, C++ was noticeably slower. This unexpected outcome prompted me to delve deeper into the underlying reasons for the performance disparity.</p>
<h2>The Algorithm</h2>
<p>The algorithm starts at the root of a storage device and traverses the filesystem in a depth-first manner, examining every directory and file. When a directory is encountered, a task is dispatched to a work-stealing thread pool, allowing for concurrent traversal of multiple directories. At the end of the process, the total number of files and directories, as well as the combined size of all files, is calculated. Symlinks are deliberately excluded from traversal, ensuring a more straightforward analysis.</p>
<h2>The C++ Implementation</h2>
<p>The C++ implementation is pretty straightforward. I used <code>std::filesystem</code> to walk through the directories and files. I am also using a threadpool library called <code>BS::thread_pool</code> which is a work-stealing thread pool implemented by <a href="https://github.com/bshoshany/thread-pool">Barak Shoshany</a>.</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code class="language-cpp"><span style="color:rgb(191,104,217);">#include</span>&nbsp;<span style="color:rgb(142,189,107);">&lt;iostream&gt;</span><br><span style="color:rgb(191,104,217);">#include</span>&nbsp;<span style="color:rgb(142,189,107);">&lt;utility&gt;</span><br><span style="color:rgb(191,104,217);">#include</span>&nbsp;<span style="color:rgb(142,189,107);">&lt;filesystem&gt;</span><br><span style="color:rgb(191,104,217);">#include</span>&nbsp;<span style="color:rgb(142,189,107);">&lt;mutex&gt;</span><br><span style="color:rgb(191,104,217);">#include</span>&nbsp;<span style="color:rgb(142,189,107);">&lt;vector&gt;</span><br><span style="color:rgb(191,104,217);">#include</span>&nbsp;<span style="color:rgb(142,189,107);">"mimalloc-new-delete.h"</span>&nbsp;<span style="color:rgb(83,89,101);font-style: italic;">//&nbsp;enable&nbsp;mimalloc&nbsp;new/delete&nbsp;overloads</span><br><span style="color:rgb(191,104,217);">#include</span>&nbsp;<span style="color:rgb(142,189,107);">"BS_thread_pool.hpp"</span><br><br><span style="color:rgb(191,104,217);">namespace</span>&nbsp;<span style="color:rgb(226,184,107);">fs</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">filesystem</span><span style="color:rgb(122,129,142);">;</span><br><span style="color:rgb(191,104,217);">namespace</span>&nbsp;<span style="color:rgb(226,184,107);">chrono</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">;</span><br><br><span style="color:rgb(191,104,217);">class</span>&nbsp;<span style="color:rgb(226,184,107);">file_metadata</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br><span style="color:rgb(191,104,217);">public</span><span style="color:rgb(122,129,142);">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">string</span>&nbsp;<span style="color:rgb(72,176,189);">name</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">long</span>&nbsp;<span style="color:rgb(72,176,189);">size</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">file_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(72,176,189);">creation_time</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">file_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(72,176,189);">modification_time</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">file_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(72,176,189);">access_time</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">bool</span>&nbsp;<span style="color:rgb(72,176,189);">is_directory</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">bool</span>&nbsp;<span style="color:rgb(72,176,189);">is_file</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(79,166,237);">file_metadata</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">string</span>&nbsp;<span style="color:rgb(229,85,97);">name</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(204,144,87);">long</span>&nbsp;<span style="color:rgb(229,85,97);">size</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">file_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(229,85,97);">creation_time</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">file_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(229,85,97);">modification_time</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">file_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(229,85,97);">access_time</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">bool</span>&nbsp;<span style="color:rgb(229,85,97);">is_directory</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(204,144,87);">bool</span>&nbsp;<span style="color:rgb(229,85,97);">is_file</span><span style="color:rgb(122,129,142);">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">:</span>&nbsp;<span style="color:rgb(229,85,97);">name</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">move</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">name</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(229,85,97);">size</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">size</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(229,85,97);">creation_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">creation_time</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(229,85,97);">modification_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">modification_time</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(229,85,97);">access_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">access_time</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(229,85,97);">is_directory</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">is_directory</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(229,85,97);">is_file</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">is_file</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><span style="color:rgb(122,129,142);">}</span><br><span style="color:rgb(122,129,142);">}</span><span style="color:rgb(122,129,142);">;</span><br><br><span style="color:rgb(191,104,217);">class</span>&nbsp;<span style="color:rgb(226,184,107);">dirstat</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br><span style="color:rgb(191,104,217);">private</span><span style="color:rgb(122,129,142);">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">vector</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">file_metadata</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(72,176,189);">entries</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">mutex</span>&nbsp;<span style="color:rgb(72,176,189);">entries_mutex</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">BS</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">thread_pool</span>&nbsp;<span style="color:rgb(72,176,189);">pool</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">auto</span>&nbsp;<span style="color:rgb(79,166,237);">read_dir</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">path</span>&nbsp;<span style="color:rgb(191,104,217);">const</span><span style="color:rgb(160,168,183);">&amp;</span><span style="color:rgb(229,85,97);">&nbsp;</span><span style="color:rgb(160,168,183);">directory_path</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">-&gt;</span>&nbsp;<span style="color:rgb(204,144,87);">void</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">for</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(191,104,217);">const</span>&nbsp;<span style="color:rgb(204,144,87);">auto</span>&nbsp;<span style="color:rgb(160,168,183);">&amp;</span><span style="color:rgb(160,168,183);">entry</span><span style="color:rgb(122,129,142);">:</span>&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">directory_iterator</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">directory_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">auto</span><span style="color:rgb(160,168,183);">&amp;</span>&nbsp;<span style="color:rgb(160,168,183);">entry_path</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(160,168,183);">entry</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">path</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(83,89,101);font-style: italic;">//&nbsp;Skip&nbsp;symlinks</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">if</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">is_symlink</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">continue</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">if</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">is_directory</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">scoped_lock</span>&nbsp;<span style="color:rgb(79,166,237);">lock</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(72,176,189);">entries_mutex</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(72,176,189);">entries</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">emplace_back</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">string</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">last_write_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">last_write_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">last_write_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">true</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(204,144,87);">false</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(72,176,189);">pool</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">detach_task</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">[</span><span style="color:rgb(229,85,97);">this</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">]</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">return</span>&nbsp;<span style="color:rgb(79,166,237);">read_dir</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span>&nbsp;<span style="color:rgb(191,104,217);">else</span>&nbsp;<span style="color:rgb(191,104,217);">if</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">is_regular_file</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">auto</span>&nbsp;<span style="color:rgb(160,168,183);">file_size</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(160,168,183);">file_size</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">scoped_lock</span>&nbsp;<span style="color:rgb(79,166,237);">lock</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(72,176,189);">entries_mutex</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(72,176,189);">entries</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">emplace_back</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">string</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">file_size</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">last_write_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">last_write_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">last_write_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">false</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(204,144,87);">true</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><br><span style="color:rgb(191,104,217);">public</span><span style="color:rgb(122,129,142);">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">auto</span>&nbsp;<span style="color:rgb(79,166,237);">walk_storage</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">path</span>&nbsp;<span style="color:rgb(191,104,217);">const</span><span style="color:rgb(160,168,183);">&amp;</span><span style="color:rgb(229,85,97);">&nbsp;</span><span style="color:rgb(160,168,183);">path</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">-&gt;</span>&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">vector</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">file_metadata</span><span style="color:rgb(122,129,142);">&gt;</span><span style="color:rgb(226,184,107);">&nbsp;</span><span style="color:rgb(191,104,217);">const</span><span style="color:rgb(160,168,183);">&amp;</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(79,166,237);">read_dir</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(72,176,189);">pool</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">wait</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">return</span>&nbsp;<span style="color:rgb(72,176,189);">entries</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><span style="color:rgb(122,129,142);">}</span><span style="color:rgb(122,129,142);">;</span><br><br><span style="color:rgb(204,144,87);">auto</span>&nbsp;<span style="color:rgb(79,166,237);">main</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">-&gt;</span>&nbsp;<span style="color:rgb(204,144,87);">int</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">string</span>&nbsp;<span style="color:rgb(160,168,183);">root</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x"</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">dirstat</span>&nbsp;<span style="color:rgb(160,168,183);">ds</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">auto</span><span style="color:rgb(160,168,183);">&amp;</span>&nbsp;<span style="color:rgb(160,168,183);">result</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(160,168,183);">ds</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">walk_storage</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">root</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">long</span>&nbsp;<span style="color:rgb(160,168,183);">total_size</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">for</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(191,104,217);">const</span>&nbsp;<span style="color:rgb(204,144,87);">auto</span>&nbsp;<span style="color:rgb(160,168,183);">&amp;</span><span style="color:rgb(160,168,183);">entry</span><span style="color:rgb(122,129,142);">:</span>&nbsp;<span style="color:rgb(160,168,183);">result</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(160,168,183);">total_size</span>&nbsp;<span style="color:rgb(160,168,183);">+=</span>&nbsp;<span style="color:rgb(160,168,183);">entry</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">size</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">double</span>&nbsp;<span style="color:rgb(160,168,183);">total_size_mb</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(204,144,87);">double</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(160,168,183);">total_size</span>&nbsp;<span style="color:rgb(160,168,183);">/</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(204,144,87);">1024.0</span>&nbsp;<span style="color:rgb(160,168,183);">*</span>&nbsp;<span style="color:rgb(204,144,87);">1024.0</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">double</span>&nbsp;<span style="color:rgb(160,168,183);">total_size_gb</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(204,144,87);">double</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(160,168,183);">total_size</span>&nbsp;<span style="color:rgb(160,168,183);">/</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(204,144,87);">1024.0</span>&nbsp;<span style="color:rgb(160,168,183);">*</span>&nbsp;<span style="color:rgb(204,144,87);">1024.0</span>&nbsp;<span style="color:rgb(160,168,183);">*</span>&nbsp;<span style="color:rgb(204,144,87);">1024.0</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(160,168,183);">cout</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(142,189,107);">"[+]&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;"</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(160,168,183);">total_size</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(142,189,107);">"&nbsp;B</span><span style="color:rgb(229,85,97);">\n</span><span style="color:rgb(142,189,107);">"</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(160,168,183);">cout</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(142,189,107);">"[+]&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;"</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">format</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(142,189,107);">"{}"</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">total_size_mb</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(142,189,107);">"&nbsp;MB</span><span style="color:rgb(229,85,97);">\n</span><span style="color:rgb(142,189,107);">"</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(160,168,183);">cout</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(142,189,107);">"[+]&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;"</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">format</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(142,189,107);">"{}"</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">total_size_gb</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(142,189,107);">"&nbsp;GB</span><span style="color:rgb(229,85,97);">\n</span><span style="color:rgb(142,189,107);">"</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(160,168,183);">cout</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(142,189,107);">"[+]&nbsp;Number&nbsp;of&nbsp;files:&nbsp;"</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(160,168,183);">result</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">size</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">&lt;&lt;</span>&nbsp;<span style="color:rgb(142,189,107);">"</span><span style="color:rgb(229,85,97);">\n</span><span style="color:rgb(142,189,107);">"</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">return</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><span style="color:rgb(122,129,142);">;</span><br><span style="color:rgb(122,129,142);">}</span><br></code></pre>
<p><strong>Note</strong>: You may notice that <code>fs::last_write_time(entry_path)</code> is called multiple times during construction of the <code>file_metadata</code> class. This is not a mistake but a workaround for the missing <code>fs::creation_time</code> and <code>fs::access_time</code> functions in the <code>std::filesystem</code> library. If you need similar functions you can use the <code>boost::filesystem</code> library.</p>
<h2>The Java Implementation</h2>
<p>The Java implementation is pretty straightforward as well. I used the <code>java.nio.file</code> package to walk through the directories and files. I also used the <code>ExecutorService</code> to create a work-stealing thread pool to walk through the directories concurrently.</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code class="language-java"><span style="color:rgb(191,104,217);">package</span>&nbsp;<span style="color:rgb(160,168,183);">sg</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">edu</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">ntu</span><span style="color:rgb(122,129,142);">;</span><br><br><span style="color:rgb(191,104,217);">import</span>&nbsp;<span style="color:rgb(160,168,183);">java</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">io</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(226,184,107);">File</span><span style="color:rgb(122,129,142);">;</span><br><span style="color:rgb(191,104,217);">import</span>&nbsp;<span style="color:rgb(160,168,183);">java</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">io</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(226,184,107);">IOException</span><span style="color:rgb(122,129,142);">;</span><br><span style="color:rgb(191,104,217);">import</span>&nbsp;<span style="color:rgb(160,168,183);">java</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">nio</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">file</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(226,184,107);">Files</span><span style="color:rgb(122,129,142);">;</span><br><span style="color:rgb(191,104,217);">import</span>&nbsp;<span style="color:rgb(160,168,183);">java</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">nio</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">file</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(226,184,107);">Path</span><span style="color:rgb(122,129,142);">;</span><br><span style="color:rgb(191,104,217);">import</span>&nbsp;<span style="color:rgb(160,168,183);">java</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">nio</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">file</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">attribute</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(226,184,107);">BasicFileAttributes</span><span style="color:rgb(122,129,142);">;</span><br><span style="color:rgb(191,104,217);">import</span>&nbsp;<span style="color:rgb(160,168,183);">java</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">nio</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">file</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">attribute</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(226,184,107);">FileTime</span><span style="color:rgb(122,129,142);">;</span><br><span style="color:rgb(191,104,217);">import</span>&nbsp;<span style="color:rgb(160,168,183);">java</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">util</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(229,85,97);">*</span><span style="color:rgb(122,129,142);">;</span><br><span style="color:rgb(191,104,217);">import</span>&nbsp;<span style="color:rgb(160,168,183);">java</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">util</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">concurrent</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(226,184,107);">ExecutorService</span><span style="color:rgb(122,129,142);">;</span><br><span style="color:rgb(191,104,217);">import</span>&nbsp;<span style="color:rgb(160,168,183);">java</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">util</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">concurrent</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(226,184,107);">Executors</span><span style="color:rgb(122,129,142);">;</span><br><br><span style="color:rgb(191,104,217);">public</span>&nbsp;<span style="color:rgb(191,104,217);">class</span>&nbsp;<span style="color:rgb(226,184,107);">Main</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">record</span>&nbsp;<span style="color:rgb(226,184,107);">FileMetadata</span><span style="color:rgb(122,129,142);">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">String</span>&nbsp;<span style="color:rgb(229,85,97);">name</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">long</span>&nbsp;<span style="color:rgb(229,85,97);">sz</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">FileTime</span>&nbsp;<span style="color:rgb(229,85,97);">creationTime</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">FileTime</span>&nbsp;<span style="color:rgb(229,85,97);">modificationTime</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">FileTime</span>&nbsp;<span style="color:rgb(229,85,97);">lastAccessTime</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">boolean</span>&nbsp;<span style="color:rgb(229,85,97);">isDirectory</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">boolean</span>&nbsp;<span style="color:rgb(229,85,97);">isFile</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">static</span>&nbsp;<span style="color:rgb(226,184,107);">FileMetadata</span>&nbsp;<span style="color:rgb(79,166,237);">tryFromPath</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">Path</span>&nbsp;<span style="color:rgb(229,85,97);">path</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">try</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">BasicFileAttributes</span>&nbsp;<span style="color:rgb(160,168,183);">attributes</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(226,184,107);">Files</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">readAttributes</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">path</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(226,184,107);">BasicFileAttributes</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(191,104,217);">class</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">boolean</span>&nbsp;<span style="color:rgb(160,168,183);">isDirectory</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(160,168,183);">attributes</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(160,168,183);">isDirectory</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">return</span>&nbsp;<span style="color:rgb(191,104,217);">new</span>&nbsp;<span style="color:rgb(226,184,107);">FileMetadata</span><span style="color:rgb(122,129,142);">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(229,85,97);">path</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">toString</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(160,168,183);">isDirectory</span>&nbsp;<span style="color:rgb(191,104,217);">?</span>&nbsp;<span style="color:rgb(204,144,87);">0</span>&nbsp;<span style="color:rgb(191,104,217);">:</span>&nbsp;<span style="color:rgb(160,168,183);">attributes</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">size</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(160,168,183);">attributes</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(229,85,97);">creationTime</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(160,168,183);">attributes</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">lastModifiedTime</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(160,168,183);">attributes</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(229,85,97);">lastAccessTime</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(160,168,183);">isDirectory</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(160,168,183);">attributes</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">isRegularFile</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span>&nbsp;<span style="color:rgb(191,104,217);">catch</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">IOException</span>&nbsp;<span style="color:rgb(160,168,183);">e</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">System</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(72,176,189);">out</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">printf</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(142,189,107);">"[-]&nbsp;Got&nbsp;IOException:&nbsp;</span><span style="color:rgb(204,144,87);">%s</span><span style="color:rgb(229,85,97);">\n</span><span style="color:rgb(142,189,107);">"</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">e</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">return</span>&nbsp;<span style="color:rgb(204,144,87);">null</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">public</span>&nbsp;<span style="color:rgb(191,104,217);">static</span>&nbsp;<span style="color:rgb(204,144,87);">void</span>&nbsp;<span style="color:rgb(79,166,237);">main</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">String</span><span style="color:rgb(122,129,142);">[</span><span style="color:rgb(122,129,142);">]</span>&nbsp;<span style="color:rgb(229,85,97);">args</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">List</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">FileMetadata</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(160,168,183);">files</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(79,166,237);">walkStorage</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(142,189,107);">"/mnt/sn850x"</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">long</span>&nbsp;<span style="color:rgb(160,168,183);">totalSz</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(160,168,183);">files</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">stream</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">mapToLong</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">FileMetadata</span><span style="color:rgb(160,168,183);">::</span><span style="color:rgb(229,85,97);">sz</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">sum</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">double</span>&nbsp;<span style="color:rgb(160,168,183);">totalSzMb</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(160,168,183);">totalSz</span>&nbsp;<span style="color:rgb(160,168,183);">/</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(204,144,87);">1024.0</span>&nbsp;<span style="color:rgb(160,168,183);">*</span>&nbsp;<span style="color:rgb(204,144,87);">1024.0</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">double</span>&nbsp;<span style="color:rgb(160,168,183);">totalSzGb</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(160,168,183);">totalSz</span>&nbsp;<span style="color:rgb(160,168,183);">/</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(204,144,87);">1024.0</span>&nbsp;<span style="color:rgb(160,168,183);">*</span>&nbsp;<span style="color:rgb(204,144,87);">1024.0</span>&nbsp;<span style="color:rgb(160,168,183);">*</span>&nbsp;<span style="color:rgb(204,144,87);">1024.0</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">System</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(72,176,189);">out</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">printf</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(142,189,107);">"[+]&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;</span><span style="color:rgb(204,144,87);">%d</span><span style="color:rgb(142,189,107);">&nbsp;B</span><span style="color:rgb(229,85,97);">\n</span><span style="color:rgb(142,189,107);">"</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">totalSz</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">System</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(72,176,189);">out</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">printf</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(142,189,107);">"[+]&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;</span><span style="color:rgb(204,144,87);">%f</span><span style="color:rgb(142,189,107);">&nbsp;MB</span><span style="color:rgb(229,85,97);">\n</span><span style="color:rgb(142,189,107);">"</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">totalSzMb</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">System</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(72,176,189);">out</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">printf</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(142,189,107);">"[+]&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;</span><span style="color:rgb(204,144,87);">%f</span><span style="color:rgb(142,189,107);">&nbsp;GB</span><span style="color:rgb(229,85,97);">\n</span><span style="color:rgb(142,189,107);">"</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">totalSzGb</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">System</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(72,176,189);">out</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">printf</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(142,189,107);">"[+]&nbsp;Number&nbsp;of&nbsp;files:&nbsp;</span><span style="color:rgb(204,144,87);">%d</span><span style="color:rgb(229,85,97);">\n</span><span style="color:rgb(142,189,107);">"</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">files</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">size</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">private</span>&nbsp;<span style="color:rgb(191,104,217);">static</span>&nbsp;<span style="color:rgb(226,184,107);">List</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">FileMetadata</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(79,166,237);">walkStorage</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">String</span>&nbsp;<span style="color:rgb(229,85,97);">path</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">try</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">ExecutorService</span>&nbsp;<span style="color:rgb(160,168,183);">pool</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(226,184,107);">Executors</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">newWorkStealingPool</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">List</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">FileMetadata</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(160,168,183);">fileMetadata</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(226,184,107);">Collections</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">synchronizedList</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(191,104,217);">new</span>&nbsp;<span style="color:rgb(226,184,107);">ArrayList</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(122,129,142);">&gt;</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(79,166,237);">readDir</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">path</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">fileMetadata</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">pool</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">return</span>&nbsp;<span style="color:rgb(160,168,183);">fileMetadata</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span>&nbsp;<span style="color:rgb(191,104,217);">catch</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">Exception</span>&nbsp;<span style="color:rgb(160,168,183);">e</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">return</span>&nbsp;<span style="color:rgb(226,184,107);">List</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">of</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">private</span>&nbsp;<span style="color:rgb(191,104,217);">static</span>&nbsp;<span style="color:rgb(204,144,87);">void</span>&nbsp;<span style="color:rgb(79,166,237);">readDir</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">String</span>&nbsp;<span style="color:rgb(229,85,97);">path</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(226,184,107);">List</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">FileMetadata</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(229,85,97);">fileMetadata</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(226,184,107);">ExecutorService</span>&nbsp;<span style="color:rgb(229,85,97);">pool</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">File</span>&nbsp;<span style="color:rgb(160,168,183);">baseFile</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(191,104,217);">new</span>&nbsp;<span style="color:rgb(226,184,107);">File</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">File</span><span style="color:rgb(122,129,142);">[</span><span style="color:rgb(122,129,142);">]</span>&nbsp;<span style="color:rgb(160,168,183);">files</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(160,168,183);">baseFile</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">listFiles</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">file</span>&nbsp;<span style="color:rgb(160,168,183);">-&gt;</span>&nbsp;<span style="color:rgb(160,168,183);">!</span><span style="color:rgb(226,184,107);">Files</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">isSymbolicLink</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">file</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">toPath</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">if</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">files</span>&nbsp;<span style="color:rgb(160,168,183);">!=</span>&nbsp;<span style="color:rgb(204,144,87);">null</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">for</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">File</span>&nbsp;<span style="color:rgb(160,168,183);">file</span><span style="color:rgb(160,168,183);">:</span>&nbsp;<span style="color:rgb(160,168,183);">files</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">if</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(229,85,97);">isDirectory</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(229,85,97);">fileMetadata</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">add</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">FileMetadata</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">tryFromPath</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">toPath</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(229,85,97);">pool</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">submit</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">-&gt;</span>&nbsp;<span style="color:rgb(79,166,237);">readDir</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">getAbsolutePath</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(229,85,97);">fileMetadata</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(229,85,97);">pool</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span>&nbsp;<span style="color:rgb(191,104,217);">else</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(229,85,97);">fileMetadata</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">add</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">FileMetadata</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">tryFromPath</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">toPath</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><span style="color:rgb(122,129,142);">}</span><br></code></pre>
<h2>The benchmark</h2>
<p>All benchmarks were done on the following machine. <code>time</code> command was used to measure the time taken.</p>
<ul>
<li>CPU: AMD Ryzen 7 5800X3D @ 4.5GHz</li>
<li>RAM: 32GB DDR4 3200MHz</li>
<li>Storage: WD_BLACK SN850X 1TB NVMe SSD</li>
<li>OS: CachyOS Linux x86_64 Rolling Release</li>
<li>Kernel: 6.8.7-3-cachyos</li>
<li>C++ Compiler: clang version 17.0.6 and GCC 13.2.1</li>
<li>Java Version: OpenJDK 22 2024-03-19</li>
</ul>
<h3>Dropping page cache</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code class="language-sh"><span style="color:rgb(79,166,237);">sudo</span>&nbsp;<span style="color:rgb(229,85,97);">sh</span>&nbsp;<span style="color:rgb(229,85,97);">-c</span>&nbsp;<span style="color:rgb(142,189,107);">'echo&nbsp;3&nbsp;&gt;/proc/sys/vm/drop_caches'</span><br></code></pre>
<h3>With Page Cache (Java)</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;56254073733&nbsp;B<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;53648.065312&nbsp;MB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;52.390689&nbsp;GB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Number&nbsp;of&nbsp;files:&nbsp;414615<br><br><span style="color:rgb(229,85,97);">________________________________________________________</span><br>Executed&nbsp;in&nbsp;&nbsp;458.40&nbsp;millis&nbsp;&nbsp;&nbsp;&nbsp;fish&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external<br>&nbsp;&nbsp;&nbsp;usr&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;2.14&nbsp;secs&nbsp;&nbsp;&nbsp;&nbsp;177.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;2.14&nbsp;secs<br>&nbsp;&nbsp;&nbsp;sys&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;2.98&nbsp;secs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;95.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;2.98&nbsp;secs<br></code></pre>
<h3>With Page Cache (C++)</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;56254068454&nbsp;B<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;53648.06027793884&nbsp;MB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;52.39068386517465&nbsp;GB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Number&nbsp;of&nbsp;files:&nbsp;414615<br><br><span style="color:rgb(229,85,97);">________________________________________________________</span><br>Executed&nbsp;in&nbsp;&nbsp;&nbsp;&nbsp;3.74&nbsp;secs&nbsp;&nbsp;&nbsp;&nbsp;fish&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external<br>&nbsp;&nbsp;&nbsp;usr&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;0.76&nbsp;secs&nbsp;&nbsp;177.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;0.76&nbsp;secs<br>&nbsp;&nbsp;&nbsp;sys&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;4.74&nbsp;secs&nbsp;&nbsp;109.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;4.74&nbsp;secs<br></code></pre>
<h3>Without Page Cache (Java)</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;56254073734&nbsp;B<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;53648.065313&nbsp;MB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;52.390689&nbsp;GB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Number&nbsp;of&nbsp;files:&nbsp;414615<br><br><span style="color:rgb(229,85,97);">________________________________________________________</span><br>Executed&nbsp;in&nbsp;&nbsp;718.45&nbsp;millis&nbsp;&nbsp;&nbsp;&nbsp;fish&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external<br>&nbsp;&nbsp;&nbsp;usr&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;1.86&nbsp;secs&nbsp;&nbsp;&nbsp;&nbsp;196.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;1.86&nbsp;secs<br>&nbsp;&nbsp;&nbsp;sys&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;4.90&nbsp;secs&nbsp;&nbsp;&nbsp;&nbsp;110.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;4.90&nbsp;secs<br></code></pre>
<h3>Without Page Cache (C++)</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;56254074259&nbsp;B<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;53648.06581401825&nbsp;MB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;52.3906892715022&nbsp;GB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Number&nbsp;of&nbsp;files:&nbsp;414615<br><br><span style="color:rgb(229,85,97);">________________________________________________________</span><br>Executed&nbsp;in&nbsp;&nbsp;&nbsp;&nbsp;3.15&nbsp;secs&nbsp;&nbsp;&nbsp;&nbsp;fish&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external<br>&nbsp;&nbsp;&nbsp;usr&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;0.86&nbsp;secs&nbsp;&nbsp;182.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;0.86&nbsp;secs<br>&nbsp;&nbsp;&nbsp;sys&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;6.51&nbsp;secs&nbsp;&nbsp;105.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;6.51&nbsp;secs<br></code></pre>
<p>Looking at the benchmark numbers, C++ is faster without page cache LMAO. Which is weird since page cache is supposed to help with performance!</p>
<h2>What in the world? Why is Java faster than C++?</h2>
<p>I was surprised to find that Java was faster than C++ in this case. I was expecting C++ to be faster due to the fact that it is a systems programming language and is closer to the hardware. However, it seems that the <code>std::filesystem</code> library is not as optimized as the <code>java.nio.file</code> package. I suspect that the reason for this is that <code>std::filesystem</code> is a wrapper around the POSIX filesystem API which makes system calls for every operation. This is evident when we look at the <code>strace</code> output of the C++ program. For brevity, I will only show the 1 part of the output.</p>
<h3>Command to get <code>strace</code> output</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code class="language-sh"><span style="color:rgb(79,166,237);">strace</span>&nbsp;<span style="color:rgb(229,85,97);">/mnt/sn850x/dirstat/impl/cpp/cmake-build-release/cpp</span>&nbsp;<span style="color:rgb(160,168,183);">&amp;&gt;</span>&nbsp;<span style="color:rgb(229,85,97);">cpp.txt</span><br></code></pre>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code class="language-sh"><span style="color:rgb(79,166,237);">strace</span>&nbsp;<span style="color:rgb(229,85,97);">-f</span>&nbsp;<span style="color:rgb(229,85,97);">java</span>&nbsp;<span style="color:rgb(229,85,97);">-jar</span>&nbsp;<span style="color:rgb(229,85,97);">/mnt/sn850x/dirstat/impl/java/out/artifacts/java_jar/java.jar</span>&nbsp;<span style="color:rgb(160,168,183);">&amp;&gt;</span>&nbsp;<span style="color:rgb(229,85,97);">java.txt</span><br></code></pre>
<h3>C++ <code>strace</code> output at <code>/mnt/sn850x/.Trash-1000</code> (directory)</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code class="language-sh"><span style="color:rgb(79,166,237);">newfstatat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(79,166,237);">AT_FDCWD,</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x/.Trash-1000"</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(229,85,97);">{</span><span style="color:rgb(229,85,97);">st_mode=S_IFDIR</span><span style="color:rgb(160,168,183);">|</span><span style="color:rgb(79,166,237);">0700,</span>&nbsp;<span style="color:rgb(229,85,97);">st_size=4096,</span>&nbsp;<span style="color:rgb(229,85,97);">...</span><span style="color:rgb(229,85,97);">}</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(229,85,97);">AT_SYMLINK_NOFOLLOW</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><br><span style="color:rgb(79,166,237);">newfstatat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(79,166,237);">AT_FDCWD,</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x/.Trash-1000"</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(229,85,97);">{</span><span style="color:rgb(229,85,97);">st_mode=S_IFDIR</span><span style="color:rgb(160,168,183);">|</span><span style="color:rgb(79,166,237);">0700,</span>&nbsp;<span style="color:rgb(229,85,97);">st_size=4096,</span>&nbsp;<span style="color:rgb(229,85,97);">...</span><span style="color:rgb(229,85,97);">}</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><br><span style="color:rgb(79,166,237);">newfstatat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(79,166,237);">AT_FDCWD,</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x/.Trash-1000"</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(229,85,97);">{</span><span style="color:rgb(229,85,97);">st_mode=S_IFDIR</span><span style="color:rgb(160,168,183);">|</span><span style="color:rgb(79,166,237);">0700,</span>&nbsp;<span style="color:rgb(229,85,97);">st_size=4096,</span>&nbsp;<span style="color:rgb(229,85,97);">...</span><span style="color:rgb(229,85,97);">}</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><br><span style="color:rgb(79,166,237);">newfstatat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(79,166,237);">AT_FDCWD,</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x/.Trash-1000"</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(229,85,97);">{</span><span style="color:rgb(229,85,97);">st_mode=S_IFDIR</span><span style="color:rgb(160,168,183);">|</span><span style="color:rgb(79,166,237);">0700,</span>&nbsp;<span style="color:rgb(229,85,97);">st_size=4096,</span>&nbsp;<span style="color:rgb(229,85,97);">...</span><span style="color:rgb(229,85,97);">}</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><br></code></pre>
<h3>C++ <code>strace</code> output at <code>/mnt/sn850x/backup.zip</code> (file)</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code class="language-sh"><span style="color:rgb(79,166,237);">newfstatat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(79,166,237);">AT_FDCWD,</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x/backup.zip"</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(229,85,97);">{</span><span style="color:rgb(229,85,97);">st_mode=S_IFREG</span><span style="color:rgb(160,168,183);">|</span><span style="color:rgb(79,166,237);">0644,</span>&nbsp;<span style="color:rgb(229,85,97);">st_size=12613917413,</span>&nbsp;<span style="color:rgb(229,85,97);">...</span><span style="color:rgb(229,85,97);">}</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(229,85,97);">AT_SYMLINK_NOFOLLOW</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><br><span style="color:rgb(79,166,237);">newfstatat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(79,166,237);">AT_FDCWD,</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x/backup.zip"</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(229,85,97);">{</span><span style="color:rgb(229,85,97);">st_mode=S_IFREG</span><span style="color:rgb(160,168,183);">|</span><span style="color:rgb(79,166,237);">0644,</span>&nbsp;<span style="color:rgb(229,85,97);">st_size=12613917413,</span>&nbsp;<span style="color:rgb(229,85,97);">...</span><span style="color:rgb(229,85,97);">}</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><br><span style="color:rgb(79,166,237);">newfstatat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(79,166,237);">AT_FDCWD,</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x/backup.zip"</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(229,85,97);">{</span><span style="color:rgb(229,85,97);">st_mode=S_IFREG</span><span style="color:rgb(160,168,183);">|</span><span style="color:rgb(79,166,237);">0644,</span>&nbsp;<span style="color:rgb(229,85,97);">st_size=12613917413,</span>&nbsp;<span style="color:rgb(229,85,97);">...</span><span style="color:rgb(229,85,97);">}</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><br><span style="color:rgb(79,166,237);">newfstatat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(79,166,237);">AT_FDCWD,</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x/backup.zip"</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(229,85,97);">{</span><span style="color:rgb(229,85,97);">st_mode=S_IFREG</span><span style="color:rgb(160,168,183);">|</span><span style="color:rgb(79,166,237);">0644,</span>&nbsp;<span style="color:rgb(229,85,97);">st_size=12613917413,</span>&nbsp;<span style="color:rgb(229,85,97);">...</span><span style="color:rgb(229,85,97);">}</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><br><span style="color:rgb(79,166,237);">newfstatat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(79,166,237);">AT_FDCWD,</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x/backup.zip"</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(229,85,97);">{</span><span style="color:rgb(229,85,97);">st_mode=S_IFREG</span><span style="color:rgb(160,168,183);">|</span><span style="color:rgb(79,166,237);">0644,</span>&nbsp;<span style="color:rgb(229,85,97);">st_size=12613917413,</span>&nbsp;<span style="color:rgb(229,85,97);">...</span><span style="color:rgb(229,85,97);">}</span><span style="color:rgb(229,85,97);">,</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(204,144,87);">0</span><br></code></pre>
<h3>Java <code>strace</code> output at <code>/mnt/sn850x/.Trash-1000</code> (directory)</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code class="language-sh"><span style="color:rgb(122,129,142);">[</span><span style="color:rgb(79,166,237);">pid</span>&nbsp;<span style="color:rgb(204,144,87);">2575295</span><span style="color:rgb(229,85,97);">]</span>&nbsp;<span style="color:rgb(229,85,97);">newfstatat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">AT_FDCWD,</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x/.Trash-1000/files"</span><span style="color:rgb(229,85,97);">,</span>&nbsp;&nbsp;<span style="color:rgb(160,168,183);">&lt;</span><span style="color:rgb(229,85,97);">unfinished</span>&nbsp;<span style="color:rgb(229,85,97);">...</span><span style="color:rgb(160,168,183);">&gt;</span><br></code></pre>
<h3>Java <code>strace</code> output at <code>/mnt/sn850x/backup.zip</code> (file)</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code class="language-sh"><span style="color:rgb(122,129,142);">[</span><span style="color:rgb(79,166,237);">pid</span>&nbsp;<span style="color:rgb(204,144,87);">2575259</span><span style="color:rgb(229,85,97);">]</span>&nbsp;<span style="color:rgb(229,85,97);">newfstatat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">AT_FDCWD,</span>&nbsp;<span style="color:rgb(142,189,107);">"/mnt/sn850x/backup.zip"</span><span style="color:rgb(229,85,97);">,</span>&nbsp;&nbsp;<span style="color:rgb(160,168,183);">&lt;</span><span style="color:rgb(229,85,97);">unfinished</span>&nbsp;<span style="color:rgb(229,85,97);">...</span><span style="color:rgb(160,168,183);">&gt;</span><br></code></pre>
<p>As we can see from the <code>strace</code> output, the C++ program is making multiple system calls for every operation while the Java program is making only 1 system call for every operation. This corresponds exactly to the number of times <code>fs</code> functions are called in the C++ program!</p>
<h2>Why are system calls slow?</h2>
<p>System calls are inherently slow because they require a context switch from user space to kernel space. This transition involves saving the current process state, switching to kernel mode, executing the system call, and then reverting to user mode. This series of operations is resource-intensive and introduces significant overhead, which can impact performance.</p>
<p>Moreover, each system call disrupts the CPU pipeline, leading to additional performance loss as the pipeline must be flushed and rebuilt. This interruption also tends to invalidate the CPU cache, resulting in cache misses that further slow down the program. Overall, these factors contribute to the high cost of system calls and can significantly affect the efficiency of a process.</p>
<h2>How to fix this?</h2>
<p>We can call <code>sys/stat.h</code> functions directly to avoid the overhead of the <code>std::filesystem</code> library. This will reduce the number of system calls made by the C++ program and improve its performance. Here is the modified C++ program. For brevity, <code>main</code> function is not shown.</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code class="language-cpp"><span style="color:rgb(191,104,217);">class</span>&nbsp;<span style="color:rgb(226,184,107);">file_metadata</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br><span style="color:rgb(191,104,217);">public</span><span style="color:rgb(122,129,142);">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">string</span>&nbsp;<span style="color:rgb(72,176,189);">name</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">long</span>&nbsp;<span style="color:rgb(72,176,189);">size</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">system_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(72,176,189);">creation_time</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">system_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(72,176,189);">modification_time</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">system_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(72,176,189);">access_time</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">bool</span>&nbsp;<span style="color:rgb(72,176,189);">is_directory</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">bool</span>&nbsp;<span style="color:rgb(72,176,189);">is_file</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">bool</span>&nbsp;<span style="color:rgb(72,176,189);">is_symlink</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(79,166,237);">file_metadata</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">string</span>&nbsp;<span style="color:rgb(229,85,97);">name</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(204,144,87);">long</span>&nbsp;<span style="color:rgb(229,85,97);">size</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">system_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(229,85,97);">creation_time</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">system_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(229,85,97);">modification_time</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">system_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(229,85,97);">access_time</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">bool</span>&nbsp;<span style="color:rgb(229,85,97);">is_directory</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(204,144,87);">bool</span>&nbsp;<span style="color:rgb(229,85,97);">is_file</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(204,144,87);">bool</span>&nbsp;<span style="color:rgb(229,85,97);">is_symlink</span><span style="color:rgb(122,129,142);">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">:</span>&nbsp;<span style="color:rgb(229,85,97);">name</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">move</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">name</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(229,85,97);">size</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">size</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(229,85,97);">creation_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">creation_time</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(229,85,97);">modification_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">modification_time</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(229,85,97);">access_time</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">access_time</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(229,85,97);">is_directory</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">is_directory</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(229,85,97);">is_file</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">is_file</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(229,85,97);">is_symlink</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(229,85,97);">is_symlink</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><span style="color:rgb(122,129,142);">}</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">static</span>&nbsp;<span style="color:rgb(204,144,87);">auto</span>&nbsp;<span style="color:rgb(79,166,237);">from_path</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(191,104,217);">const</span>&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">path</span>&nbsp;<span style="color:rgb(160,168,183);">&amp;</span><span style="color:rgb(160,168,183);">path</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">-&gt;</span>&nbsp;<span style="color:rgb(226,184,107);">file_metadata</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(83,89,101);font-style: italic;">//&nbsp;call&nbsp;stat&nbsp;on&nbsp;the&nbsp;path</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">struct</span>&nbsp;<span style="color:rgb(226,184,107);">stat</span>&nbsp;<span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">{</span><span style="color:rgb(122,129,142);">}</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(79,166,237);">lstat</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">path</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">c_str</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">&amp;</span><span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">system_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(160,168,183);">access_time</span><span style="color:rgb(122,129,142);">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">seconds</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">st_atim</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">tv_sec</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">+</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">nanoseconds</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">st_atim</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">tv_nsec</span><span style="color:rgb(122,129,142);">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">system_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(160,168,183);">modification_time</span><span style="color:rgb(122,129,142);">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">seconds</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">st_mtim</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">tv_sec</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">+</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">nanoseconds</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">st_mtim</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">tv_nsec</span><span style="color:rgb(122,129,142);">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">time_point</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">system_clock</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(160,168,183);">creation_time</span><span style="color:rgb(122,129,142);">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">seconds</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">st_ctim</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">tv_sec</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">+</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">chrono</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">nanoseconds</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">st_ctim</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">tv_nsec</span><span style="color:rgb(122,129,142);">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">return</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(160,168,183);">path</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">string</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);font-weight: bold;">S_ISDIR</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">st_mode</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(191,104,217);">?</span>&nbsp;<span style="color:rgb(204,144,87);">0</span>&nbsp;<span style="color:rgb(191,104,217);">:</span>&nbsp;<span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">st_size</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(160,168,183);">creation_time</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(160,168,183);">modification_time</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(160,168,183);">access_time</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);font-weight: bold;">S_ISDIR</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">st_mode</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);font-weight: bold;">S_ISREG</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">st_mode</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);font-weight: bold;">S_ISLNK</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_stat</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">st_mode</span><span style="color:rgb(122,129,142);">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><span style="color:rgb(122,129,142);">}</span><span style="color:rgb(122,129,142);">;</span><br><br><span style="color:rgb(191,104,217);">class</span>&nbsp;<span style="color:rgb(226,184,107);">dirstat</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br><span style="color:rgb(191,104,217);">private</span><span style="color:rgb(122,129,142);">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">vector</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">file_metadata</span><span style="color:rgb(122,129,142);">&gt;</span>&nbsp;<span style="color:rgb(72,176,189);">entries</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">mutex</span>&nbsp;<span style="color:rgb(72,176,189);">entries_mutex</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">BS</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">thread_pool</span>&nbsp;<span style="color:rgb(72,176,189);">pool</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">auto</span>&nbsp;<span style="color:rgb(79,166,237);">read_dir</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(191,104,217);">const</span>&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">path</span>&nbsp;<span style="color:rgb(160,168,183);">&amp;</span><span style="color:rgb(160,168,183);">directory_path</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">-&gt;</span>&nbsp;<span style="color:rgb(204,144,87);">void</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">for</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(191,104,217);">const</span>&nbsp;<span style="color:rgb(204,144,87);">auto</span>&nbsp;<span style="color:rgb(160,168,183);">&amp;</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">:</span>&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">directory_iterator</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">directory_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">auto</span>&nbsp;<span style="color:rgb(160,168,183);">file_metadata</span>&nbsp;<span style="color:rgb(160,168,183);">=</span>&nbsp;<span style="color:rgb(160,168,183);">file_metadata</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(79,166,237);">from_path</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">if</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_metadata</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">is_directory</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">scoped_lock</span>&nbsp;<span style="color:rgb(79,166,237);">lock</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(72,176,189);">entries_mutex</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(72,176,189);">entries</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">emplace_back</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_metadata</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(72,176,189);">pool</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">detach_task</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">[</span><span style="color:rgb(229,85,97);">this</span><span style="color:rgb(122,129,142);">,</span>&nbsp;<span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">]</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">return</span>&nbsp;<span style="color:rgb(79,166,237);">read_dir</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">entry_path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span>&nbsp;<span style="color:rgb(191,104,217);">else</span>&nbsp;<span style="color:rgb(191,104,217);">if</span>&nbsp;<span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_metadata</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">is_file</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">scoped_lock</span>&nbsp;<span style="color:rgb(79,166,237);">lock</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(72,176,189);">entries_mutex</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(72,176,189);">entries</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">emplace_back</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">file_metadata</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><br><span style="color:rgb(191,104,217);">public</span><span style="color:rgb(122,129,142);">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(204,144,87);">auto</span>&nbsp;<span style="color:rgb(79,166,237);">walk_storage</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(191,104,217);">const</span>&nbsp;<span style="color:rgb(226,184,107);">fs</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">path</span>&nbsp;<span style="color:rgb(160,168,183);">&amp;</span><span style="color:rgb(160,168,183);">path</span><span style="color:rgb(122,129,142);">)</span>&nbsp;<span style="color:rgb(160,168,183);">-&gt;</span>&nbsp;<span style="color:rgb(226,184,107);">std</span><span style="color:rgb(122,129,142);">::</span><span style="color:rgb(226,184,107);">vector</span><span style="color:rgb(122,129,142);">&lt;</span><span style="color:rgb(226,184,107);">file_metadata</span><span style="color:rgb(122,129,142);">&gt;</span><span style="color:rgb(160,168,183);">&amp;</span>&nbsp;<span style="color:rgb(122,129,142);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(79,166,237);">read_dir</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(160,168,183);">path</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(72,176,189);">pool</span><span style="color:rgb(122,129,142);">.</span><span style="color:rgb(79,166,237);">wait</span><span style="color:rgb(122,129,142);">(</span><span style="color:rgb(122,129,142);">)</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(191,104,217);">return</span>&nbsp;<span style="color:rgb(72,176,189);">entries</span><span style="color:rgb(122,129,142);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(122,129,142);">}</span><br><span style="color:rgb(122,129,142);">}</span><span style="color:rgb(122,129,142);">;</span><br></code></pre>
<p>Notice that we are calling <code>lstat</code> directly on the path to get the file metadata. This reduces the number of system calls made by the C++ program and improves its performance. Here is the benchmark result with the modified C++ program.</p>
<h3>With Page Cache (C++)</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;56254074259&nbsp;B<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;53648.06581401825&nbsp;MB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;52.3906892715022&nbsp;GB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Number&nbsp;of&nbsp;files:&nbsp;414615<br><br><span style="color:rgb(229,85,97);">________________________________________________________</span><br>Executed&nbsp;in&nbsp;&nbsp;217.61&nbsp;millis&nbsp;&nbsp;&nbsp;&nbsp;fish&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external<br>&nbsp;&nbsp;&nbsp;usr&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;0.56&nbsp;secs&nbsp;&nbsp;&nbsp;&nbsp;176.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;0.56&nbsp;secs<br>&nbsp;&nbsp;&nbsp;sys&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;1.61&nbsp;secs&nbsp;&nbsp;&nbsp;&nbsp;159.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;1.61&nbsp;secs<br></code></pre>
<h3>Without Page Cache (C++)</h3>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-language">Code</span><button class="code-block-copy" aria-label="Copy code"><i data-lucide="copy"></i></button></div><pre style="background-color: rgb(31, 35, 41)"><code><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;56254074259&nbsp;B<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;53648.06581401825&nbsp;MB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Total&nbsp;size&nbsp;of&nbsp;all&nbsp;files:&nbsp;52.3906892715022&nbsp;GB<br><span style="color:rgb(79,166,237);">[</span><span style="color:rgb(79,166,237);">+</span><span style="color:rgb(79,166,237);">]</span>&nbsp;Number&nbsp;of&nbsp;files:&nbsp;414615<br><br><span style="color:rgb(229,85,97);">________________________________________________________</span><br>Executed&nbsp;in&nbsp;&nbsp;519.53&nbsp;millis&nbsp;&nbsp;&nbsp;&nbsp;fish&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external<br>&nbsp;&nbsp;&nbsp;usr&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;0.56&nbsp;secs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;0.56&nbsp;secs<br>&nbsp;&nbsp;&nbsp;sys&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;3.43&nbsp;secs&nbsp;&nbsp;&nbsp;&nbsp;392.00&nbsp;micros&nbsp;&nbsp;&nbsp;&nbsp;3.43&nbsp;secs<br></code></pre>
<p>As we can see, the modified C++ program is now faster than the Java program. This is because we are now making fewer system calls and reducing the overhead of the <code>std::filesystem</code> library.</p>
<h2>Conclusion</h2>
<p>This article explored why Java outperformed C++ in a filesystem tree-walking benchmark. The analysis revealed that the C++ std::filesystem library was causing performance bottlenecks by making multiple system calls for each operation, leading to slower execution. To address this, we optimized the C++ program by directly using lstat to retrieve file metadata, significantly reducing the number of system calls and enhancing performance.</p>
<p>Additionally, Java's superior speed was attributed to the highly optimized java.nio.file package. These results demonstrate that high-level languages, with their well-optimized libraries, can sometimes surpass the performance of low-level languages, challenging common assumptions about programming language efficiency.</p>
</article>
</div><!-- Footer -->
<footer class="border-t border-border-color py-8 bg-background-primary">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-8 md:gap-6 text-center md:text-left">
            <div class="flex flex-col sm:flex-row items-center gap-2 sm:gap-3">
                <svg width="24" height="24" viewBox="0 0 150 150" fill="none" xmlns="http://www.w3.org/2000/svg"
                    class="text-text-primary">
                    <path fill="currentColor"
                        d="M 0 56.25 L 0 116.25 L 20.832031 116.25 C 23.023438 116.25 25.1875 116.636719 27.210938 117.390625 C 29.234375 118.144531 31.070312 119.25 32.617188 120.644531 C 34.164062 122.035156 35.394531 123.691406 36.230469 125.511719 C 37.070312 127.328125 37.5 129.28125 37.5 131.25 L 37.5 150 L 87.5 150 L 150 93.75 L 150 33.75 L 129.167969 33.75 C 126.976562 33.75 124.8125 33.363281 122.789062 32.609375 C 120.765625 31.855469 118.929688 30.75 117.382812 29.355469 C 115.835938 27.964844 114.605469 26.308594 113.769531 24.492188 C 112.929688 22.671875 112.5 20.71875 112.5 18.75 L 112.5 0 L 62.5 0 Z M 70.832031 112.5 L 41.667969 112.5 L 41.667969 71.25 L 79.167969 37.5 L 108.332031 37.5 L 108.332031 78.75 Z" />
                </svg>
                <span class="text-text-secondary text-sm">
                    Powered by <a href="https://haxiom.io"
                        class="text-text-primary hover:text-accent-primary transition-colors">haxiom.io</a>
                </span>
            </div>

            <div class="flex flex-col sm:flex-row items-center gap-2 sm:gap-6 text-sm text-text-secondary">
                <a href="https://haxiom.instatus.com/"
                    class="hover:text-text-primary transition-colors flex items-center gap-2">
                    <span class="w-2 h-2 bg-accent-primary rounded-full breathing-dot"></span>
                    All Systems Operational
                </a>
                <span> 2025 All rights reserved</span>
            </div>
        </div>
    </div>
</footer>
</div>

<!-- Alpine.js Toast Component -->
<div x-data="{ show: false, message: '' }" x-show="show" x-transition:enter="transition-all duration-300"
    x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0"
    x-transition:leave="transition-all duration-300" x-transition:leave-start="opacity-100 translate-y-0"
    x-transition:leave-end="opacity-0 translate-y-2"
    @show-toast.window="message = $event.detail.message; show = true; setTimeout(() => show = false, 3000)"
    class="fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-accent-primary text-background-primary px-4 py-2 shadow-lg z-50 font-medium text-xs sm:text-sm"
    style="display: none;">
    <span x-text="message"></span>
</div>

<script>
    // Share URLs - initialize after share buttons are loaded
    (function () {
        const url = encodeURIComponent(window.location.href);
        const title = encodeURIComponent(document.title);
        const postData = 'I just read Java outruns C++ while std::filesystem stops for syscall snacks. Check it out on haxiom.io';

        const shareTwitter = document.getElementById("share-twitter");
        if (shareTwitter) {
            shareTwitter.href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(postData)}&url=${url}`;
        }

        const shareHackerNews = document.getElementById("share-hackernews");
        if (shareHackerNews) {
            shareHackerNews.href = `https://news.ycombinator.com/submitlink?u=${url}&t=${title}`;
        }

        const shareLink = document.getElementById("share-link");
        if (shareLink) {
            shareLink.onclick = function () {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    window.dispatchEvent(new CustomEvent('show-toast', {
                        detail: { message: 'Link copied to clipboard' }
                    }));
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                });
            };
        }
    })();
</script>

</body>

</html>